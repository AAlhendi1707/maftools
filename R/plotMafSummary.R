#' Plots maf summary.
#'
#' @description Plots maf summary.
#'
#' @param an MAF object generated by \code{read.maf}
#' @param file If given pdf file will be generated.
#' @param width plot parameter for output file.
#' @param height plot parameter for output file.
#' @export

plotmafSummary = function(maf, file = NULL, width = 6, height = 5){

  require(cowplot, quietly = T)

  #hard coded color scheme
  col = c('#CCCCCC',brewer.pal(12, name = "Paired"), brewer.pal(11, name = "Spectral")[1:3], "maroon")
  names(col) = names = c('',"Nonstop_Mutation", "Frame_Shift_Del",
                         "Intron", "Missense_Mutation", "IGR", "Nonsense_Mutation",
                         "RNA", "Splice_Site", "In_Frame_Del", "Frame_Shift_Ins",
                         "Silent", "In_Frame_Ins", "ITD", "In_Frame_Ins", "Translation_Start_Site",
                         "two_hit")

  vcs = getSampleSummary(maf)
  vcs[,total:=NULL]
  vcs = vcs[order(rowSums(vcs[,2:ncol(vcs), with = F]), decreasing = T)] #order tsbs based on number of mutations
  vcs = vcs[,c(1,order(colSums(x = vcs[,2:ncol(vcs), with =F]), decreasing = T)+1), with =F] #order based on most event

  #melt data frame
  vcs.m = melt(vcs, id.vars = 'Tumor_Sample_Barcode')
  colnames(vcs.m) = c('Tumor_Sample_Barcode', 'Variant_Classification', 'N')

  vcs.m$Tumor_Sample_Barcode = factor(vcs.m$Tumor_Sample_Barcode,levels = vcs$Tumor_Sample_Barcode) #reorder tsb levels
  vcs.m$Variant_Classification = factor(x = vcs.m$Variant_Classification, levels = colnames(vcs)) #reorder Variant classification

  #top ggplot
  vcs.gg = ggplot(data = vcs.m, aes(x = Tumor_Sample_Barcode, y = N, fill = Variant_Classification))+geom_bar(stat = 'identity')+scale_fill_manual(values = col)+
    theme_bw()+theme(axis.ticks = element_blank(), axis.text.x = element_blank(), legend.position = 'none')+ylab('# of Variants')+xlab('Samples')
  #bottom ggplot
  vcs.gg2 = ggplot(data = vcs.m, aes(x = Variant_Classification, y = N, fill = Variant_Classification))+geom_boxplot(outlier.shape = NA)+scale_fill_manual(values = col)+
    theme_bw()+theme(axis.ticks = element_blank(), axis.text.x = element_blank(), legend.position = 'bottom')+
    theme(legend.key.size = unit(0.5, "cm"), legend.title = element_blank(), legend.text = element_text(size = 7))
  #organize plots
  gg.summary = plot_grid(vcs.gg, vcs.gg2, nrow = 2, ncol = 1)

  #print to file if specified.
  if(!is.null(file)){
    save_plot(filename = paste(file, 'pdf', sep = '.'), plot = gg.summary, base_width = width, base_height = height, base_aspect_ratio = 1.5)
  }

  print(gg.summary)

}
