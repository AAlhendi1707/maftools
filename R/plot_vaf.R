#' Plots vaf distribution of genes
#' @description takes output generated by read.maf and plots vaf distribution.
#'
#' @param maf output generated by \code{read.maf}
#' @param vafCol manually specify column name for vafs. Default looks for column 't_vaf'
#' @param genes specify genes for which plots has to be generated
#' @param density logical whether to plot density plot of vaf
#' @param violin plots violin plot
#' @param top if \code{genes} is NULL plots top n number of genes. Defaults to 5.
#' @return ggplot object which can be further modified.
#' @export

plotVaf = function(maf, vafCol = NULL, genes = NULL, density = F, violin = F, top = 5){

  dat = maf$data

  if(!'t_vaf' %in% colnames(dat)){
    if(is.null(vafCol)){
      print(colnames(dat))
      stop('t_vaf field is missing. Use addReadCounts to add read-depth and vaf info, Or use vafCol to manually specify vaf column name.')
    }else{
      colnames(dat)[which(colnames(dat) == vafCol)] = 't_vaf'
    }
  }

  if(is.null(genes)){
    genes = maf$gene.summary[1:top, Hugo_Symbol]
  }

  dat.genes = data.frame(dat[dat$Hugo_Symbol %in% genes])
  suppressMessages(datm <- melt(dat.genes[,c('Hugo_Symbol', 't_vaf')]))

  #remove NA from vcf
  datm = datm[!is.na(datm$value),]
  #maximum vaf
  max.vaf = max(as.numeric(datm$value[complete.cases(datm$value)]))

  if(max.vaf > 1){
    max.vaf = 100
  }else{
    max.vaf = 1
  }

  if(density){
    gg = ggplot(datm, aes(value, color = Hugo_Symbol))+geom_density(size = 1)+geom_point(aes(y = 0, x = value), size = 3, alpha = 0.6)+xlim(0, max.vaf)
  } else{
    if(violin){
      gg = ggplot(data = datm, aes(x = Hugo_Symbol, y = value, color = Hugo_Symbol))+geom_violin()+ylim(0, max.vaf)+theme(legend.position = 'none')+ylab('vaf')
    }else{
      gg = ggplot(data = datm, aes(x = Hugo_Symbol, y = value, color = Hugo_Symbol))+geom_boxplot()+ylim(0, max.vaf)+theme(legend.position = 'none')+ylab('vaf')
    }
  }

  print(gg)
  return(gg)
}
