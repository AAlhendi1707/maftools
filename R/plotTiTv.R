#' Plot Transition and Trasnversion ratios.
#' @description Takes results generated from \code{titv} and plots the Ti/Tv ratios and contributions of 6 mutational conversion classes in each sample.
#'
#' @param res results generated by \code{titv}
#' @param file basename for output file name. If given pdf will be generated.
#' @param width width of the plot, in inches.
#' @param height height of the plot, in inches.
#' @export


plotTiTv = function(res = NULL, file = NULL, width = 6, height = 5){

  col = brewer.pal(n = 6, name = 'Dark2')
  names(col) = c('C>T', 'C>G', 'C>A', 'A>T', 'A>G', 'A>C')

  titv.frac = res$fraction.contribution
  titv.frac.melt = melt(titv.frac, id.vars = 'Tumor_Sample_Barcode')
  titv.frac.melt$variable = factor(x = titv.frac.melt$variable, levels = c('C-T', 'C-G', 'C-A', 'A-T', 'A-G', 'A-C'),
                                   labels = c('C>T', 'C>G', 'C>A', 'A>T', 'A>G', 'A>C'))

  titv.frac.melt$TiTv = suppressWarnings( factor(x = titv.frac.melt$variable, levels = c('C>T', 'C>G', 'C>A', 'A>T', 'A>G', 'A>C'),
                                   labels = c('Ti', 'Tv', 'Tv', 'Tv', 'Ti', 'Tv')) )

  titv.contrib = suppressMessages(melt(res$TiTv.fractions))

  p1 = ggplot(data = titv.frac.melt, aes(x = variable, y = value, color = TiTv)) +
    geom_boxplot() + ylim(0, 100) +
    xlab("") + theme(axis.line = element_line(colour = "black"), legend.position = 'none') +
    ylab("Fraction of Mutations")+scale_color_manual(values = c('Ti' = 'maroon', 'Tv' = 'royalblue'))+background_grid(major = 'xy', minor = 'none')

  p2 = ggplot(data = titv.contrib, aes(x = variable, y = value, color = variable)) +
    geom_boxplot() + ylim(0, 100) +
    xlab('')+theme(axis.line = element_line(colour = "black"), legend.title = element_blank(), axis.title.y = element_blank()) +
    scale_color_manual(values = c('Ti' = 'maroon', 'Tv' = 'royalblue'))+background_grid(major = 'xy', minor = 'none')

  top = suppressWarnings(plot_grid(p1, p2, rel_widths = c(2,1)))

  p3 = ggplot(data = titv.frac.melt, aes(x = Tumor_Sample_Barcode, y = value, fill = variable))+geom_bar(stat = 'identity')+
    theme(legend.position = 'bottom', legend.title = element_blank(), axis.text.x = element_blank(),
          axis.line.y = element_blank(), axis.line.x = element_blank())+ylab('Fraction of Mutations')+xlab('Samples')

  p = suppressWarnings(plot_grid(top, p3, nrow = 2))

  print(p)

  if(!is.null(file)){
    save_plot(filename = paste(file, 'pdf', sep='.'), plot = p, base_height = height, base_width = width)
  }
}
